<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jogo da Tabuada</title>
  <link rel="stylesheet" href="../css/stylemat.css" />
  <style>
    @media (max-width: 600px) {
      .linha-tabula {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <h1>Jogo da Tabuada</h1>

  <!-- Grupo da Tabuada do 2 -->
  <div class="grupo-container" style="--cor: #FFB3BA">
    <div class="linha-tab">
      <div class="word" draggable="true" data-result="2" data-color="#FFB3BA">2</div>
      <div class="word" draggable="true" data-result="4" data-color="#FFB3BA">4</div>
      <div class="word" draggable="true" data-result="6" data-color="#FFB3BA">6</div>
      <div class="word" draggable="true" data-result="8" data-color="#FFB3BA">8</div>
      <div class="word" draggable="true" data-result="10" data-color="#FFB3BA">10</div>
      <div class="word" draggable="true" data-result="12" data-color="#FFB3BA">12</div>
      <div class="word" draggable="true" data-result="14" data-color="#FFB3BA">14</div>
      <div class="word" draggable="true" data-result="16" data-color="#FFB3BA">16</div>
      <div class="word" draggable="true" data-result="18" data-color="#FFB3BA">18</div>
      <div class="word" draggable="true" data-result="20" data-color="#FFB3BA">20</div>
    </div>
    <div class="linha-tabula">
      <div class="equacao">2 x 1 = <div class="dropzone" data-expected="2"></div></div>
      <div class="equacao">2 x 2 = <div class="dropzone" data-expected="4"></div></div>
      <div class="equacao">2 x 3 = <div class="dropzone" data-expected="6"></div></div>
      <div class="equacao">2 x 4 = <div class="dropzone" data-expected="8"></div></div>
      <div class="equacao">2 x 5 = <div class="dropzone" data-expected="10"></div></div>
      <div class="equacao">2 x 6 = <div class="dropzone" data-expected="12"></div></div>
      <div class="equacao">2 x 7 = <div class="dropzone" data-expected="14"></div></div>
      <div class="equacao">2 x 8 = <div class="dropzone" data-expected="16"></div></div>
      <div class="equacao">2 x 9 = <div class="dropzone" data-expected="18"></div></div>
      <div class="equacao">2 x 10 = <div class="dropzone" data-expected="20"></div></div>
    </div>
  </div>

  <!-- Grupo da Tabuada do 3 -->
  <div class="grupo-container" style="--cor: #FFDFBA">
    <div class="linha-tab">
      <div class="word" draggable="true" data-result="3" data-color="#FFDFBA">3</div>
      <div class="word" draggable="true" data-result="6" data-color="#FFDFBA">6</div>
      <div class="word" draggable="true" data-result="9" data-color="#FFDFBA">9</div>
      <div class="word" draggable="true" data-result="12" data-color="#FFDFBA">12</div>
      <div class="word" draggable="true" data-result="15" data-color="#FFDFBA">15</div>
      <div class="word" draggable="true" data-result="18" data-color="#FFDFBA">18</div>
      <div class="word" draggable="true" data-result="21" data-color="#FFDFBA">21</div>
      <div class="word" draggable="true" data-result="24" data-color="#FFDFBA">24</div>
      <div class="word" draggable="true" data-result="27" data-color="#FFDFBA">27</div>
      <div class="word" draggable="true" data-result="30" data-color="#FFDFBA">30</div>
    </div>
    <div class="linha-tabula">
      <div class="equacao">3 x 1 = <div class="dropzone" data-expected="3"></div></div>
      <div class="equacao">3 x 2 = <div class="dropzone" data-expected="6"></div></div>
      <div class="equacao">3 x 3 = <div class="dropzone" data-expected="9"></div></div>
      <div class="equacao">3 x 4 = <div class="dropzone" data-expected="12"></div></div>
      <div class="equacao">3 x 5 = <div class="dropzone" data-expected="15"></div></div>
      <div class="equacao">3 x 6 = <div class="dropzone" data-expected="18"></div></div>
      <div class="equacao">3 x 7 = <div class="dropzone" data-expected="21"></div></div>
      <div class="equacao">3 x 8 = <div class="dropzone" data-expected="24"></div></div>
      <div class="equacao">3 x 9 = <div class="dropzone" data-expected="27"></div></div>
      <div class="equacao">3 x 10 = <div class="dropzone" data-expected="30"></div></div>
    </div>
  </div>

  <!-- Mensagem de parabéns -->
  <div id="parabens-container" style="display:none">
    <button id="fechar-parabens" onclick="this.parentElement.style.display='none'">&times;</button>
    <h2>Parabéns! Você completou esta fase!</h2>
    <button id="jogar-novamente" onclick="location.reload()">Jogar novamente</button>
  </div>

  <!-- Script -->
  <script>
    function embaralharBlocos(grupoSelector) {
      document.querySelectorAll(grupoSelector).forEach(container => {
        const filhos = Array.from(container.children);
        for (let i = filhos.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          container.appendChild(filhos[j]);
        }
      });
    }

    embaralharBlocos('.linha-tab');

    const words = document.querySelectorAll('.word');
    const dropzones = document.querySelectorAll('.dropzone');

    words.forEach(word => {
      word.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', word.dataset.result);
        e.dataTransfer.setData('color', word.dataset.color);
      });
    });

    dropzones.forEach(zone => {
      zone.addEventListener('dragover', e => e.preventDefault());
      zone.addEventListener('drop', e => {
        e.preventDefault();
        const valor = e.dataTransfer.getData('text/plain');
        const cor = e.dataTransfer.getData('color');
        if (valor === zone.dataset.expected) {
          zone.innerHTML = `<span class="dropped" style="background-color:${cor}">${valor}</span>`;
          zone.classList.add('preenchido');
          document.querySelectorAll('.word').forEach(w => {
            if (w.textContent === valor && w.dataset.color === cor) w.remove();
          });
          verificarFinalizacao();
        }
      });
    });

    function verificarFinalizacao() {
      if (document.querySelectorAll('.word').length === 0) {
        document.getElementById('parabens-container').style.display = 'block';
      }
    }

    if ('ontouchstart' in window || navigator.maxTouchPoints) {
      let tocando = false;
      let elementoTocado = null;

      document.body.addEventListener("touchstart", e => {
        const touch = e.touches[0];
        const alvo = e.target;
        if (alvo.classList.contains("word")) {
          e.preventDefault();
          tocando = true;
          elementoTocado = alvo.cloneNode(true);
          elementoTocado.classList.add("touch-dragging");
          elementoTocado.id = "dragging-temp";
          elementoTocado.style.left = touch.pageX + "px";
          elementoTocado.style.top = touch.pageY + "px";
          document.body.appendChild(elementoTocado);
        }
      });

      window.addEventListener("touchmove", e => {
        if (tocando && elementoTocado) {
          const touch = e.touches[0];
          elementoTocado.style.left = (touch.pageX - 30) + "px";
          elementoTocado.style.top = (touch.pageY - 20) + "px";
        }
      });

      window.addEventListener("touchend", e => {
        if (tocando && elementoTocado) {
          const touch = e.changedTouches[0];
          const x = touch.clientX;
          const y = touch.clientY;
          const cor = elementoTocado.dataset.color;
          const valor = elementoTocado.textContent;
          for (let dz of document.querySelectorAll(".dropzone:not(.preenchido)")) {
            const rect = dz.getBoundingClientRect();
            const tolerancia = 20;
            if (
              x >= rect.left - tolerancia &&
              x <= rect.right + tolerancia &&
              y >= rect.top - tolerancia &&
              y <= rect.bottom + tolerancia
            ) {
              if (dz.dataset.expected === valor) {
                dz.innerHTML = `<span class=\"dropped\" style=\"background-color:${cor}\">${valor}</span>`;
                dz.classList.add("preenchido");
                document.querySelectorAll('.word').forEach(w => {
                  if (w.textContent === valor && w.dataset.color === cor) w.remove();
                });
                verificarFinalizacao();
              }
              break;
            }
          }
          document.getElementById("dragging-temp")?.remove();
          elementoTocado = null;
          tocando = false;
        }
      });
    }
  </script>
</body>
</html>
